package main

import (
	f "fmt"
)

var obstacles map[point]bool

func six() {
	input := `......##...#...#....#.......#....................##............#.#..#.......#.........................................#...........
..................................#.............#................................#..........##..................#.................
....#......................#................#...........................................#....................................#....
............#..............#...#...#...............#..........#.#....#..........................#....##...........................
....#.............#.....#.....................................................................#...#..........................#....
.................#............#......................#.................#.............#..................#.........................
................#...............#....................#...#..#...#.#.....................................................#.........
..............#.#...............................................................#....................#.......#....................
.............#...#..#............................#..............#..#.........................................#....................
.........................#.........#..#.......#...#..............#..#..............................#.........#............#.......
#...............................................................................................................#.................
..........................#.....#.........................#...................#.......#.........................#.................
...........#...........#........#........................#..........#.#.................#........#............#...............#...
..#..#................#...................................................#..................................................#....
.....#............................#..........................................................................#....................
................#.....#...........................#..........................................#.........#........................#.
..#...........................................##............#.........#..........................#.......................#.....#..
.....................#.............#.....#.......#.##.....#......................................#.#..#.#.........................
.......#...##.....#..........#...............#....#..........................#..............................................##....
..#.......#..................##..............#..........................#.#....#....#....................#.#.#...............#....
....................#.......#.......#............#..............#.......#.........#...#.....#........#.#..........................
...............................................#.....#........................................#..#.........#..........#...........
............#...#.............................................................................#.......##..........................
##..........................#...........................#..............................#..........................................
..............................................#.............................................#.................................#...
.............#..............#................##...........#...............#.......................................................
......#............#.......#..#....#.............................................................................#.#..............
..#..##..#..................#...............................................##......#........................................#....
..#...............................#.#........#................................................#.....#........#.#..................
.........#.......#.....................................#............................#..............................#..............
..........................................................................................................#.....................#.
....................#......................................#..........................#.........................##................
........#..............................................................................#.#..................#..................#..
........................................................^..#...................#....#..............##.............................
..#.#........................................................#..#..................#.....................................#....#...
.........................#....#............................#......................................................................
.#......#.............................................................................................#....................###....
...........#...#.#............#........................................................................#..........................
......#..........#.............................#.#.................................#...#.............#.#........................#.
...............................................#..........#.......#.........#........................................#.#..........
.................#.....................#.......#..................................................................................
.#...............#.........#...................#..............#........................#.....#....................................
...........#..............#..................................................................#...................................#
.................#.............#...........#.......................................#......................#......#..........#.....
........#..#.................#..........#....................................................#.....#...........#.................#
.....................#..#.................#......#......#..#..#..........#........................#...........................##..
.................#........#....#.................................................#.#.........................#............#..#....
.....................#...............##...................#.....#..#............................#.#.............#.................
.#..#......##...............#.......#..........................................................................#......#...........
#..#...................................#.#................#.....#.................................#...........................#...
..............#............................#............#...#...#.............#..........#............#...#............#..........
..........##.................#................................#...........#.#....#...............................................#
......#...........#.............#..........#.............#............#...................#.......................#...............
..............#.......#...........................................................................................................
...#................................................................#...............................#....#...............#........
...#..##................#..............................................................................#..........##.#............
.#........#..........#..................#......................#...........#......................................................
....#.......................#...#...........................................#..................#...............................#..
.............................#...........#..........#.................#.....................................................#.....
...........#.........#............#...............................#................#..............#.........................#.....
..........#........#.....#.....................................#.................#.....................................#..#.......
...#.......#...................................................................#.................#................................
.#....#........#..............................#........#.....#........#..#...#.#......................#..........................#
.....................................................................#....................#.......................................
.............................#..............................#.#....................................................#............#.
..#.....#.......#.......#......................#.#.#.........................................................#.....#........#.....
...............#..........#..#....#..................#..........................................#.................................
............#...................#................#.............................................................................#..
........#...#......................................##....................#..................#..........##............#...#........
......................#......#......#.#.........................................................................#.............#...
........#......................................................................................#.................#................
.................................................#....................#..............##.......................................#..#
.............#..........................................................#.................#..........................#....#......#
......................#.....................#............................#..................#...........#.........................
#..............#...........................#...#.#................................................................................
.......#............................#...........................................................#...............#.................
........................#..................................................................................#......................
...................#..........................#.........#........#...........................#....................................
.............#............#.......................................................................................##....#.........
................#.........#.....................................................................................................#.
........#.............................#.................................#.......##..............#............................#....
#........#.....#.....#.......#...............................#....................................................#..............#
........................#.............................#.....#...........#........#............#...................................
..................#...........#...#.............................................................................#...............#.
...................#..................#...................#..............................#....#...........#..............#........
...............#................#.#....................#.........#.........#.............#.........#......#..................#....
..................#.............................#...........................#....#....#......#..#.#....................#..........
...#.......................................#...............................................................#................#.....
...................#.........................................................#....................................................
.................#..............................#.................................................................................
.............#.......#...#....................................................#........#....................................#...#.
..............#...................#.#..........#....................................................#....#...#.##....#............
........#..#...........................................#.........#...#...............#.........................#..................
#.....#...........................................#.................................................#.............................
#...........................................#..........#..........................................#...............#...............
............................#.................................................#...#...............................................
.#...................#.......................................................................................#......#...##..#.....
.....#..#...............#........#....#.........#........................#.............#..........................................
...................#................#........................................#.#..................................................
......#.#...........................#...................#..........#..........#......#............................................
..........................#.#..............#............#.#.......................................................................
...#..#........................#..............................................#..#...#.....#........#.............................
..........................#.....................#.........................................................#............#.#........
............................#.....................#.............#.................................................................
..........................................#..#.................................................................#......#.#.#.......
..........##......................................#................................##....................#..#.....................
..............#.......................................................#...........................................................
..........#........#........................................................................................#........#...#........
......................#.#...................#...............#.....#......................#.....#.......#.......#..........#.......
......#..#....#..................#.........................................#......................................................
...............#.....#..#..........................................##.........................................##.............#....
.....................#..................#..................................#...................#............................#.#...
..#................#..#................................................#...........#..........#.............#...................#.
.......#.............#.......................................................................#...#.........................##..#..
...#...................#..................#.............#..#.........................................#........##..................
.................................#...........#........#.....................#.........................#..#........................
.......#..................#..................................#......................................#.#....................#......
..................................................................................#...........#....#.......#......#..........#....
........##.........................................................#.......................#........#............#................
...#...............##.#..................#....................................#.............#.................#...................
..................##.........#...................#......#................#......................................................#.
.#....................#............#..............#.............#.........#........................................#......#..#....
...............#...........................................................#........................#.............#...............
#............................#...................#...............................##..#...............#..........................#.
................#.............#..........#.........#..........................#....#..............................#..............#
...................................#.........................................#....................................................
....#................................................................#.#..#..........#....#.............................#.........
...........#.............#..........#........#...#...#........#.............#.......................................##............
.........#.......................#..........#....#.......................................#.....#...#.#..........#.................
.......................#...........#.......#......#.#...............................................#.................#.#.........`

	lines := lines(input)
	max = point{len(lines), len(lines[0]), 0}

	directions := map[rune]int{'^': 1, '>': 2, 'v': 3, '<': 4}
	var direction int
	var guard point

	obstacles := make(map[point]bool)
	for x, line := range lines {
		for y, c := range line {
			if c == '#' {
				obstacles[point{x, y, 0}] = true
			}
			if dir, ok := directions[c]; ok {
				guard.x, guard.y = x, y
				direction = dir
			}
		}
	}

	f.Printf("6) %d\n", visited(guard, direction, obstacles))
	f.Printf("6) %d\n", loops(obstacles))
}

func visited(guard point, direction int, obstacles map[point]bool) int {
	visit := make(map[point]bool)
	visit[guard] = true
	done := false
	for {
		var next point = guard
		switch direction {
		case 1:
			if guard.x-1 >= 0 {
				next.x = guard.x - 1
			} else {
				done = true
			}
		case 2:
			if guard.y+1 < max.y {
				next.y = guard.y + 1
			} else {
				done = true
			}
		case 3:
			if guard.x+1 < max.x {
				next.x = guard.x + 1
			} else {
				done = true
			}
		case 4:
			if guard.y-1 >= 0 {
				next.y = guard.y - 1
			} else {
				done = true
			}
		}

		if done {
			break
		}

		if _, ok := obstacles[next]; ok {
			if direction == 4 {
				direction = 1
			} else {
				direction += 1
			}
		} else {
			guard = next
			visit[guard] = true
		}
	}

	return len(visit)
}

func loops(obstacles map[point]bool) int {
	visited := make(map[int]bool)
	/*
		A loop is possible if
		1) obstacle
		2) obstacle in the next direction = 1.x + 1, y > 1.y
		3) obstacle in the next direction = x > 2.x, 2.y - 1
		4) obstacle in the next direction = 3.x - 1, 1.y - 1

		1) obstacle
		2) obstacle in the next direction = 1.x + 1, y > 1.y
		3) obstacle in the next direction = x > 2.x, 2.y - 1

		1) obstacle
		2) obstacle in the next direction = 1.x + 1, y > 1.y
		4) obstacle in the next direction = x > 2.x, 1.y - 1

		1) obstacle
		3) obstacle in the next direction = x > 1.x + 1, y > 1.y
		4) obstacle in the next direction = 3.x - 1, 1.y - 1
	*/

	for obstacle := range obstacles {
		var first []point
		var second []point

		for compare := range obstacles {
			if obstacle == compare {
				continue
			}
			if compare.x == obstacle.x+1 && compare.y > obstacle.y {
				first = append(first, compare)
			}
			if compare.x > obstacle.x+1 && compare.y > obstacle.y {
				second = append(second, compare)
			}
		}
		for compare := range obstacles {
			if obstacle == compare {
				continue
			}
			for _, firstset := range first {
				if compare.x > firstset.x {
					if compare.y == firstset.y-1 || compare.y == obstacle.y-1 {
						visited[serial(obstacle, firstset, compare)] = true
					}
				}
			}
			for _, secondset := range second {
				if compare.x == secondset.x-1 && compare.y == obstacle.y-1 {
					visited[serial(obstacle, secondset, compare)] = true
				}
			}
		}
	}

	return len(visited)
}

func serial(a point, b point, c point) int {
	return a.x*a.y + b.x*b.y + c.x*c.y
}
